<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <style type="text/css">
        #map-canvas {
            width: 100%;
            height: 481px;
        }
        .layer {
            background-color: #e7eaeb;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;

        }

        .parallax {
            /* The image used */
            background: url(https://media.giphy.com/media/GawNJisfOUHV6/source.gif);

            /* Set a specific height */
            height: 500px;

            /* Create the parallax scrolling effect */
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        .opacity-effect {
            opacity: .9;
        }

    </style>
</head>
<body class="parallax">
    <div id="latspan" class="d-none">San Antonio</div>
    <div id="lngspan" class="d-none">San Antonio</div>

    <div  class="container-fluid layer opacity-effect">
        <div class="jumbotron jumbotron-fluid opacity-effect">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-9">
                        <h1 id="title">Your Weather Application</h1>
                    </div>
                    <div class="col-3 text-center">
                        <h3 id="cityName">San Antonio</h3>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="input-group px-3 col-8">
                        <input type="text" id="address" class="form-control" placeholder="Search for your city..." autofocus>
                        <button id="submitButton" class="btn btn-secondary" type="button">Search</button>
                    </div>
                    <div class="col-4 pl-5 text-center">
                        <p id="currentCityWeather"></p>
                    </div>
                </div>
            </div>
        </div>


            <!--THREE DAY FORECAST CARDS-->
        <div class="row justify-content-center">
            <div class="col-4 py-5 text-center">
                <div class="card opacity-effect">
                    <div class="card-block">
                        <h3 class="card-header bg-info">Day 1</h3>
                        <table id="tbl1" class="insertWeather card-text table"></table>
                    </div>
                </div>
            </div>
            <div class="col-4 py-5 text-center">
                <div class="card opacity-effect">
                    <div class="card-block">
                        <h3 class="card-header bg-info">Day 2</h3>
                        <table id="tbl2" class="insertWeather card-text table"></table>
                    </div>
                </div>
            </div>
            <div class="col-4 py-5 text-center">
                <div class="card opacity-effect">
                    <div class="card-block">
                        <h3 class="card-header bg-info">Day 3</h3>
                        <table id="tbl3" class="insertWeather card-text table"></table>
                    </div>
                </div>
            </div>
        </div>
        <div id="map-canvas" class="container-fluid"></div>
    </div>


    <!--END OF BODY CONTENT-->
    <!--JQUERY-->
    <script src="js/jquery-2.x-git.js"></script>
    <!-- BOOTSTRAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!--GOOGLE MAPS SCRIPT-->
    <script src="https://maps.google.com/maps/api/js?key=AIzaSyBvVIZozQaijJ_e-6bBlH1g5PQlbvHv6-E"></script>
    <script>
        (function() {
            "use strict";
            // Init geocoder object
            var geocoder = new google.maps.Geocoder();

            var address = {lat: 29.426791, lng: -98.489602};

            var newAddress = "";

            var trHTML = '';


            // Set our map options
            var mapOptions = {
                // Set the zoom level
                zoom: 8,
                center: address,
                styles: [{"featureType":"administrative","elementType":"labels.text","stylers":[{"weight":"2"},{"visibility":"on"}]},{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"},{"visibility":"on"},{"weight":"2.00"}]},{"featureType":"administrative","elementType":"labels.text.stroke","stylers":[{"weight":"2.00"},{"visibility":"on"}]},{"featureType":"administrative.country","elementType":"labels.text","stylers":[{"visibility":"on"},{"weight":"2"}]},{"featureType":"administrative.province","elementType":"labels.text","stylers":[{"visibility":"on"},{"weight":"2"}]},{"featureType":"administrative.locality","elementType":"labels","stylers":[{"visibility":"on"}]},{"featureType":"administrative.locality","elementType":"labels.text","stylers":[{"weight":"2"},{"visibility":"on"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"landscape","elementType":"labels.text","stylers":[{"visibility":"on"},{"weight":"2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels.text","stylers":[{"weight":"2"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#c66e4e"}]},{"featureType":"road.highway","elementType":"labels.icon","stylers":[{"visibility":"on"}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#a8ad00"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"road.local","elementType":"geometry.fill","stylers":[{"color":"#5b7f95"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#478ba7"},{"visibility":"on"}]},{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#5b7f95"}]},{"featureType":"water","elementType":"labels.text.fill","stylers":[{"color":"#ffffff"}]}]
            };

            // Render the map
            var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

            // Creates marker on map for NewAddress
            var marker = new google.maps.Marker({
                position: address,
                animation: google.maps.Animation.DROP,
                map: map,
            });


            function loadTable() {
                var trHTML = '';
            };

// DEFAULT LAND ON MAP API FUNCTION

            $.get("https://api.openweathermap.org/data/2.5/forecast", {
                APPID: "8f5c57daacb4b80dfbaab615e6a89e18",
                // lat: 29.423017,
                // lon: -98.48527,
                q: "san antonio, US",
                units: "imperial"


            }).done(function (forecast) {
                $('#cityName').text(forecast.city.name + ', ' + forecast.city.country);

                for (var i = 0; i < forecast.list.length; i++) {
                    $('#currentCityWeather').html('<strong>Current Weather: </strong>' + forecast.list[i].main.temp + 'ยบ ' + '<img src="http://openweathermap.org/img/w/' + forecast.list[i].weather[0].icon + '.png">');

                    trHTML = '<tr><td>' + forecast.list[i].main.temp_max + 'ยบ' + '/' + forecast.list[i].main.temp_min + 'ยบ' + '</td></tr><tr><td>' + '<img src="http://openweathermap.org/img/w/' + forecast.list[i].weather[0].icon + '.png">' + '</td><tr></tr><td>' + '<strong>Clouds: </strong>' + forecast.list[i].weather[0].description + '</td><tr></tr><td>'  + '<strong>Humidity: </strong>' + forecast.list[i].main.humidity + '</td><tr></tr><td>' + '<strong>Wind:  </strong>' + forecast.list[i].wind.speed + ' mph' + '</td><tr></tr><td>' + '<strong>Pressure: </strong>' + forecast.list[i].main.pressure + '</td></tr>';
                    if (i === 0) {
                        $('#tbl1').html(trHTML);
                    }else if (i === 8) {
                        $('#tbl2').html(trHTML);
                    }else if (i === 16) {
                        $('#tbl3').html(trHTML);
                    }
                };
                //End of loop
            });
// END OF DEFAULT FUNCTION^^^^^^^^^^

// INPUT SUBMIT BUTTON API FUNCTION
            $('#submitButton').click(function(event){
                event.preventDefault();
                // var lat = $('#newLat').val();
                // var lon = $('#newLon').val();
                newAddress = $('#address').val();
                console.log(newAddress)
                // placeMarker(event.latLng);
                listener(newAddress);

                $.get("https://api.openweathermap.org/data/2.5/forecast", {
                    APPID: "8f5c57daacb4b80dfbaab615e6a89e18",
                    q: newAddress,
                    units: "imperial"
                }).done(function (forecast) {
                    console.log(forecast)
                    $('#cityName').text(forecast.city.name + ', ' + forecast.city.country);


                        for (var i = 0; i < forecast.list.length; i++) {
                            $('#currentCityWeather').html('<strong>Current Weather: </strong>' + forecast.list[i].main.temp + 'ยบ ' + '<img src="http://openweathermap.org/img/w/' + forecast.list[i].weather[0].icon + '.png">');

                            trHTML = '<tr><td>' + forecast.list[i].main.temp_max + 'ยบ' + '/' + forecast.list[i].main.temp_min + 'ยบ' + '</td></tr><tr><td>' + '<img src="http://openweathermap.org/img/w/' + forecast.list[i].weather[0].icon + '.png">' + '</td><tr></tr><td>' + '<strong>Clouds: </strong>' + forecast.list[i].weather[0].description + '</td><tr></tr><td>'  + '<strong>Humidity: </strong>' + forecast.list[i].main.humidity + '</td><tr></tr><td>' + '<strong>Wind:  </strong>' + forecast.list[i].wind.speed + ' mph' + '</td><tr></tr><td>' + '<strong>Pressure: </strong>' + forecast.list[i].main.pressure + '</td></tr>';
                            if (i === 0) {
                                $('#tbl1').html(trHTML);
                            }else if (i === 8) {
                                $('#tbl2').html(trHTML);
                            }else if (i === 16) {
                                $('#tbl3').html(trHTML);
                            }
                                if (forecast.list[i].weather[0].main === "rain") {
                                    console.log("it's raining!");
                                }
                        };
                        //End of loop
                    });
                });
// ^^^^END OF INPUT SUBMIT BUTTON API FUNCTION^^^^

// CLICK ON GOOGLE MAP API FUNCTION
                    google.maps.event.addListener(map, 'click', function(event) {

                        var lat = (document.getElementById('latspan').innerHTML = event.latLng.lat());
                        var lng = (document.getElementById('lngspan').innerHTML = event.latLng.lng());
                        newAddress = {lat: lat, lng: lng};
                        console.log(newAddress);
                        placeMarker(event.latLng);

                        $.get("https://api.openweathermap.org/data/2.5/forecast", {
                        APPID: "8f5c57daacb4b80dfbaab615e6a89e18",
                        lat: newAddress.lat,
                        lon: newAddress.lng,
                        // q: address,
                        units: "imperial"
                    }).done(function (forecast) {
                        console.log(forecast)
                        $('#cityName').text(forecast.city.name + ', ' + forecast.city.country);


                            for (var i = 0; i < forecast.list.length; i++) {
                                $('#currentCityWeather').html('<strong>Current Weather: </strong>' + forecast.list[i].main.temp + 'ยบ ' + '<img src="http://openweathermap.org/img/w/' + forecast.list[i].weather[0].icon + '.png">');

                                trHTML = '<tr><td>' + forecast.list[i].main.temp_max + 'ยบ' + '/' + forecast.list[i].main.temp_min + 'ยบ' + '</td></tr><tr><td>' + '<img src="http://openweathermap.org/img/w/' + forecast.list[i].weather[0].icon + '.png">' + '</td><tr></tr><td>' + '<strong>Clouds: </strong>' + forecast.list[i].weather[0].description + '</td><tr></tr><td>'  + '<strong>Humidity: </strong>' + forecast.list[i].main.humidity + '</td><tr></tr><td>' + '<strong>Wind:  </strong>' + forecast.list[i].wind.speed + ' mph' + '</td><tr></tr><td>' + '<strong>Pressure: </strong>' + forecast.list[i].main.pressure + '</td></tr>';
                                if (i === 0) {
                                    $('#tbl1').html(trHTML);
                                }else if (i === 8) {
                                    $('#tbl2').html(trHTML);
                                }else if (i === 16) {
                                    $('#tbl3').html(trHTML);
                                }
                            };
                            //End of loop
                        });
                    });
// ^^^^END OF CLICK ON GOOGLE API FUNCTION^^^^


// FUNCTION FOR PLACING MARKER ON MAP WHEN CLICKING ON MAP
            function placeMarker(location) {

                if (marker == null)
                {
                    marker = new google.maps.Marker({
                        position: location,
                        map: map
                    }); console.log(position); } else {   marker.setPosition(location); } }

// FUNCTION FOR PLACING MARKER ON MAP WHEN CLICKING ON MAP^^^^^^^^^^^^

// LISTENER FUNCTION FOR CLICK EVENTS
            function listener(search) {

                //geocoder function from google
                geocoder.geocode({ "address": newAddress }, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        // Rerender the map
                        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

                        // Recenter the map over the address
                        map.setCenter(results[0].geometry.location);

                        //Set marker on new address. The results for which are returned in the google map render function
                        marker.position = results[0].geometry.location;

                        marker.setMap(map);
                    } else {

                        // Show an error message with the status if our request fails
                        alert("Geocoding was not successful - STATUS: " + status);
                    }

                });

            };

            loadTable();

// CLOSE MAIN ANONYMOUS FUNCTION
        })();

    </script>
    
</body>
</html>

